// ========= CONTROLGASTOS =========

// Estructura organizada: apps/controlgastos/users/{userId}/...
match /apps/controlgastos/users/{userId}/expenses/{expenseId} {
  allow read, write: if isAuth() && userId == uid();
  allow create: if isAuth() && userId == uid();
  allow update, delete: if isAuth() && userId == uid();
}

match /apps/controlgastos/users/{userId}/payments/{paymentId} {
  allow read, write: if isAuth() && userId == uid();
  allow create: if isAuth() && userId == uid();
  allow update, delete: if isAuth() && userId == uid();
}

match /apps/controlgastos/users/{userId}/receipts/{receiptId} {
  allow read, write: if isAuth() && userId == uid();
  allow create: if isAuth() && userId == uid();
  allow update, delete: if isAuth() && userId == uid();
}

match /apps/controlgastos/users/{userId}/recurring_items/{itemId} {
  allow read: if isAuth() && userId == uid();
  allow create: if isAuth() 
                && userId == uid()
                && request.resource.data.userId == userId;
  allow update: if isAuth() 
                && userId == uid()
                && resource.data.userId == userId;
  allow delete: if isAuth() 
                && userId == uid()
                && resource.data.userId == userId;
}

match /apps/controlgastos/users/{userId}/recurring_items_instances/{instanceId} {
  allow read: if isAuth() && userId == uid();
  allow create: if isAuth() 
                && userId == uid()
                && request.resource.data.userId == userId;
  allow update: if isAuth() 
                && userId == uid()
                && resource.data.userId == userId;
  allow delete: if isAuth() 
                && userId == uid()
                && resource.data.userId == userId;
}

match /apps/controlgastos/users/{userId}/settings/{settingId} {
  allow read, write: if isAuth() && userId == uid();
  allow create: if isAuth() && userId == uid();
  allow update, delete: if isAuth() && userId == uid();
}

// Colecciones globales de ControlGastos
match /apps/controlgastos/categories/{categoryId} {
  allow read: if isAuth();
  allow write: if isAuth();
}

// Reglas legacy para ControlGastos (temporal - compatibilidad hacia atr√°s)
match /expenses/{expenseId} {
  allow read, write: if isAuth() && resource.data.userId == uid();
  allow create: if isAuth() && request.resource.data.userId == uid();
  allow update, delete: if isAuth() && resource.data.userId == uid();
}

match /payments/{paymentId} {
  allow read, write: if isAuth() && resource.data.userId == uid();
  allow create: if isAuth() && request.resource.data.userId == uid();
  allow update, delete: if isAuth() && resource.data.userId == uid();
}

match /invoices/{invoiceId} {
  allow read, write: if isAuth() && resource.data.userId == uid();
  allow create: if isAuth() && request.resource.data.userId == uid();
  allow update, delete: if isAuth() && resource.data.userId == uid();
}
